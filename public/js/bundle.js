!function e(t,a,r){function n(i,l){if(!a[i]){if(!t[i]){var d="function"==typeof require&&require;if(!l&&d)return d(i,!0);if(o)return o(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var m=a[i]={exports:{}};t[i][0].call(m.exports,function(e){var a=t[i][1][e];return n(a?a:e)},m,m.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}({1:[function(e,t,a){function r(){return Math.floor(Date.now()/1e3)}function n(e){f=e.createdAt,$("#device-last-seen").html($.timeago(f)),$("#device-battery").html(e.charge+"% ("+e.voltage+" V)"),$("#device-signal").html(2*e.signal-144+" dBm")}function o(){var e=$("#slider-range").slider("values",0),t=$("#slider-range").slider("values",1),a=moment.utc(e,"X").format("DD/MM/YY hh:mm:ss UTC"),n=t==r()?"Now":moment.utc(t,"X").format("DD/MM/YY hh:mm:ss UTC");$("#slider-info").html(a+" - "+n)}function i(){var e={event:"lowerbound",payload:{deviceId:p}};u.send(JSON.stringify(e))}function l(){var e={event:"upperbound",payload:{deviceId:p}};u.send(JSON.stringify(e))}function d(){var e={event:"lastknown",payload:{deviceId:p}};u.send(JSON.stringify(e))}function s(){var e=$("#slider-range").slider("values",0),t=$("#slider-range").slider("values",1),a={event:"location",payload:{deviceId:p,start:e,end:t}};u.send(JSON.stringify(a))}function m(e){return'<table class="table-popup"><tbody><tr><td>Fix</td><td>'+moment.utc(moment.utc(e.timestamp).unix(),"X").format("DD/MM/YY hh:mm:ss UTC")+"</td></tr><tr><td>Lat/Lng</td><td>"+e.latitude+", "+e.longitude+"</td></tr><tr><td>Altitude</td><td>"+e.altitude+" m</td></tr><tr><td>Speed/Course</td><td>"+e.speed+" km/h / "+e.course+"&deg;</td></tr><tr><td>Sat/HDOP</td><td>"+e.satellites+" / "+e.hdop+"</td></tr><td>Charge</td><td>"+e.charge+"% ("+e.voltage+" V)</td></tr><tr><td>Signal</td><td>"+(2*e.signal-114)+" dBm</td></tr></tbody></table>"}var u=new SockJS("/ws"),p=null,c=null,g=[],v=null,f=null;$(".ui-slider-handle").draggable(),L.mapbox.accessToken="pk.eyJ1IjoibWFwYm94IiwiYSI6IlhHVkZmaW8ifQ.hAMX5hSW-QnTeRCMAy9A8Q";var y=L.mapbox.map("map",null,{attributionControl:!1,legendControl:{position:"topright"}}).setView([51.505,-.09],2);L.control.layers({"Mapbox OSM Bright 2":L.mapbox.tileLayer("mapbox.osm-bright").addTo(y),"Mapbox Streets":L.mapbox.tileLayer("mapbox.streets"),"Mapbox Streets Satellite":L.mapbox.tileLayer("mapbox.streets-satellite"),"Mapbox Satellite":L.mapbox.tileLayer("mapbox.satellite"),"Mapbox Light":L.mapbox.tileLayer("mapbox.light"),"Mapbox Dark":L.mapbox.tileLayer("mapbox.dark"),"Mapbox Pirates":L.mapbox.tileLayer("mapbox.pirates"),"Mapbox Comic":L.mapbox.tileLayer("mapbox.comic"),"Mapbox Wheatpaste":L.mapbox.tileLayer("mapbox.wheatpaste"),OpenStreetMap:L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png"),"Stamen Toner":L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.png"),"Stamen Watercolor":L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.png")},null,{position:"topleft"}).addTo(y);var b=L.mapbox.marker.icon({"marker-size":"large","marker-symbol":"danger","marker-color":"#aa0000"}),h=L.divIcon({className:"custom-icon",iconSize:null}),x={color:"#000"};$("#slider-range").slider({range:!0,min:0,max:r(),values:[75,Date.now()/1e3],slide:function(e,t){o(),s()},create:function(e,t){o()},stop:function(e,t){s()}}),setInterval(function(){f&&$("#device-last-seen").html($.timeago(f));var e=$("#slider-range").slider("values",1),t=$("#slider-range").slider("option","max"),a=r();if($("#slider-range").slider("option","max",a),e==t){var e=$("#slider-range").slider("values",1,a);o()}},1e3),$("#form-login").submit(function(e){e.preventDefault();var t=$("#input-username").val(),a=$("#input-password").val();if(t&&a){var r={event:"authenticate",payload:{username:t.toLowerCase(),password:a}};u.send(JSON.stringify(r))}}),u.onopen=function(){$("#modal-login").modal({backdrop:"static",keyboard:!1})},u.onmessage=function(e){var t=JSON.parse(e.data);if(console.log(t),"authenticate"==t.event)"success"==t.payload.status&&t.payload.deviceId?(p=t.payload.deviceId,c=t.payload.deviceName,$("#device-name").html(c),y.legendControl.addLegend(document.getElementById("legend").innerHTML),i(),l(),$("#modal-login").modal("hide")):($("#alert-login").removeClass("hidden"),$("#alert-login").html(t.payload.message));else if("location"==t.event){for(var a=t.payload.locations,u=0;u<g.length;++u){var f=g[u];y.removeLayer(f)}v&&y.removeLayer(v),g=[];for(var M=[],u=0;u<a.length;++u){var S=a[u];if(S.latitude&&S.longitude){var f=L.marker([S.latitude,S.longitude],{icon:u==a.length-1?b:h});f.bindPopup(m(S)),f.addTo(y),g.push(f),M.push(f.getLatLng())}}v=L.polyline(M,x),v.addTo(y),g.length>0&&y.setView(g[g.length-1].getLatLng(),14)}else if("lowerbound"==t.event){var S=t.payload.location,w=moment.utc(S.timestamp).unix(),k=r();$("#slider-range").slider("option","min",w),$("#slider-range").slider("option","max",k),$("#slider-range").slider("values",0,k-1),$("#slider-range").slider("values",1,k),o(),$(".slider-container").removeClass("hidden"),s()}else if("upperbound"==t.event){var S=t.payload.location;n(S),d()}else if("update"==t.event){var S=t.payload.location;if(n(S),!S.latitude||!S.longitude)return;var k=$("#slider-range").slider("values",1);if(k!=r())return;var C=g[g.length-1];C.setIcon(h);var f=L.marker([S.latitude,S.longitude],{icon:b});f.bindPopup(m(S)),f.addTo(y),g.push(f),v.addLatLng(f.getLatLng())}else if("lastknown"==t.event){var S=t.payload.location;if(!S.latitude||!S.longitude)return;$("#slider-range").slider("values",0,moment.utc(S.timestamp).unix()),s()}}},{}]},{},[1]);