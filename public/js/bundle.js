!function e(t,a,n){function r(l,i){if(!a[l]){if(!t[l]){var d="function"==typeof require&&require;if(!i&&d)return d(l,!0);if(o)return o(l,!0);var s=new Error("Cannot find module '"+l+"'");throw s.code="MODULE_NOT_FOUND",s}var u=a[l]={exports:{}};t[l][0].call(u.exports,function(e){var a=t[l][1][e];return r(a?a:e)},u,u.exports,e,t,a,n)}return a[l].exports}for(var o="function"==typeof require&&require,l=0;l<n.length;l++)r(n[l]);return r}({1:[function(e,t,a){function n(){return Math.floor(Date.now()/1e3)}function r(e){f=e.createdAt,$("#device-last-seen").html($.timeago(f)),$("#device-battery").html(e.charge+"% ("+e.voltage+" V)"),$("#device-signal").html(2*e.signal-114+" dBm")}function o(){var e=$("#slider-range").slider("values",0),t=$("#slider-range").slider("values",1),a=t==n();y=a?!0:!1;var r=moment.utc(e,"X").format("DD/MM/YY HH:mm:ss"),o=a?"Now":moment.utc(t,"X").format("DD/MM/YY HH:mm:ss");$("#slider-info").html(r+" - "+o)}function l(){var e={event:"lowerbound",payload:{deviceId:m}};p.send(JSON.stringify(e))}function i(){var e={event:"upperbound",payload:{deviceId:m}};p.send(JSON.stringify(e))}function d(){var e={event:"lastknown",payload:{deviceId:m}};p.send(JSON.stringify(e))}function s(){var e=$("#slider-range").slider("values",0),t=$("#slider-range").slider("values",1),a={event:"location",payload:{deviceId:m,start:e,end:t}};p.send(JSON.stringify(a))}function u(e){return'<table class="table-popup"><tbody><tr><td>Fix</td><td>'+e.fix+"D "+moment.utc(moment.utc(e.timestamp).unix(),"X").format("DD/MM/YY HH:mm:ss UTC")+"</td></tr><tr><td>Lat/Lng</td><td>"+e.latitude+", "+e.longitude+"</td></tr><tr><td>Altitude</td><td>"+e.altitude+" m</td></tr><tr><td>Speed/Course</td><td>"+e.speed+" km/h / "+e.course+"&deg;</td></tr><tr><td>Sat/HDOP</td><td>"+e.satellites+" / "+e.hdop+"</td></tr><td>Charge</td><td>"+e.charge+"% ("+e.voltage+" V)</td></tr><tr><td>Signal</td><td>"+(2*e.signal-114)+" dBm</td></tr></tbody></table>"}var p=null,m=null,c=null,g=[],v=null,f=null,y=!1,b=null,x=null,h=!1;$(".ui-slider-handle").draggable(),L.mapbox.accessToken="pk.eyJ1IjoibWFwYm94IiwiYSI6IlhHVkZmaW8ifQ.hAMX5hSW-QnTeRCMAy9A8Q";var S=L.mapbox.map("map",null,{attributionControl:!1,legendControl:{position:"topright"}}).setView([51.505,-.09],2);L.control.layers({"Mapbox OSM Bright 2":L.mapbox.tileLayer("mapbox.osm-bright").addTo(S),"Mapbox Streets":L.mapbox.tileLayer("mapbox.streets"),"Mapbox Streets Satellite":L.mapbox.tileLayer("mapbox.streets-satellite"),"Mapbox Satellite":L.mapbox.tileLayer("mapbox.satellite"),"Mapbox Light":L.mapbox.tileLayer("mapbox.light"),"Mapbox Dark":L.mapbox.tileLayer("mapbox.dark"),"Mapbox Pirates":L.mapbox.tileLayer("mapbox.pirates"),"Mapbox Comic":L.mapbox.tileLayer("mapbox.comic"),"Mapbox Wheatpaste":L.mapbox.tileLayer("mapbox.wheatpaste"),OpenStreetMap:L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png"),"Stamen Toner":L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.png"),"Stamen Watercolor":L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.png")},null,{position:"topleft"}).addTo(S);var M=L.mapbox.marker.icon({"marker-size":"large","marker-symbol":"danger","marker-color":"#aa0000"}),w=L.divIcon({className:"custom-icon",iconSize:null}),k={color:"#000"};$("#slider-range").slider({range:!0,min:0,max:n(),values:[75,Date.now()/1e3],slide:function(e,t){o()},create:function(e,t){o()},stop:function(e,t){s()}}),setInterval(function(){f&&$("#device-last-seen").html($.timeago(f));var e=$("#slider-range").slider("values",1),t=$("#slider-range").slider("option","max"),a=n();if($("#slider-range").slider("option","max",a),e==t){var e=$("#slider-range").slider("values",1,a);o()}},1e3),$("#form-login").submit(function(e){e.preventDefault();var t=$("#input-username").val(),a=$("#input-password").val();if(t&&a){x={username:t.toLowerCase(),password:a};var n={event:"authenticate",payload:x};p.send(JSON.stringify(n))}});var I=function(){p=new SockJS("/ws"),clearInterval(b),p.onopen=function(){if(x){var e={event:"authenticate",payload:x};p.send(JSON.stringify(e))}else $("#modal-login").modal({backdrop:"static",keyboard:!1})},p.onmessage=function(e){var t=JSON.parse(e.data);if(console.log(t),"authenticate"==t.event){if(h)return;"success"==t.payload.status&&t.payload.deviceId?(m=t.payload.deviceId,c=t.payload.deviceName,$("#device-name").html(c),S.legendControl.addLegend(document.getElementById("legend").innerHTML),l(),i(),$("#modal-login").modal("hide")):($("#alert-login").removeClass("hidden"),$("#alert-login").html(t.payload.message))}else if("location"==t.event){for(var a=t.payload.locations,p=0;p<g.length;++p){var f=g[p];S.removeLayer(f)}v&&S.removeLayer(v),g=[];for(var b=[],p=0;p<a.length;++p){var x=a[p];if(x.latitude&&x.longitude){var f=L.marker([x.latitude,x.longitude],{icon:p==a.length-1?M:w});f.bindPopup(u(x)),f.addTo(S),g.push(f),b.push(f.getLatLng())}}v=L.polyline(b,k),v.addTo(S),g.length>0&&S.setView(g[g.length-1].getLatLng(),16)}else if("lowerbound"==t.event){var x=t.payload.location,I=n()-86400,D=n();$("#slider-range").slider("option","min",I),$("#slider-range").slider("option","max",D),$("#slider-range").slider("values",0,D-1),$("#slider-range").slider("values",1,D),o(),$(".slider-container").removeClass("hidden")}else if("upperbound"==t.event){var x=t.payload.location;r(x),d()}else if("update"==t.event){var x=t.payload.location;if(r(x),!x.latitude||!x.longitude)return;if(!y)return;var O=g[g.length-1];O.setIcon(w);var f=L.marker([x.latitude,x.longitude],{icon:M});f.bindPopup(u(x)),f.addTo(S),g.push(f),v.addLatLng(f.getLatLng())}else if("lastknown"==t.event){var x=t.payload.location;if(!x.latitude||!x.longitude)return;$("#slider-range").slider("values",0,moment.utc(x.timestamp).unix()),s()}},p.onclose=function(){p=null,h=!0,b=setInterval(function(){I()},2e3)}};I()},{}]},{},[1]);